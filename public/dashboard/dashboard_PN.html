<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Pegada Nacional</title>

    <link rel="stylesheet" href="../css/dashboard_PN.css">
    <script src="../js/sessao.js"></script>
    <script src="../js/alerta.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body style="flex-direction: row;">
    <header class="navbar">
        <div class="navbar-content">

            <div class="logo">
                <div class="logo-box">
                   <img style="width: 50px; height: 50px;" src="../assets/img/logoPegadaNacional.png" alt="logo">
                </div>
                <span class="rookie-font">PEGADA NACIONAL</span>
            </div>

            <div class="menu-dash">
                <div class="hello">
                    <h3 class="rookie-font" style="font-size: 25px;">Olá, <span id="b_usuario">usuário</span>!</h3>
                </div>
            </div>
            <nav class="menu">
                <a href="../jogoCompleteLetra.html">Tentar de novo</a>
                <a onclick="limparSessao()">Sair</a>
            </nav>

        </div>
    </header>

    <div id="div_aguardar" class="loading-div"
        style="z-index: 100; display: flex; position: absolute; background-color: rgba(0, 0, 0, 0.4); justify-content: center; align-items: center; height: 100vh; width: 100%; display: none;">
        <img style="width: 600px; height: 300px; margin-top: 15px;" src="../assets/video/DJ_loading.gif"
            id="loading-gif">
    </div>

    <div class="dashboards1">
        <div class="linha-kpi">

            <div class="caixa-kpi">
                <h4>Taxa de Acertos</h4>
                <div id="div_KPI_taxaAcertos" style=" height: auto; width: 80%; font-size: 32px; justify-content: center;">
                    <span id="resultado"
                        style="font-family: 'Courier New', Courier, monospace; font-weight: bolder;">0%
                    </span>
                </div>
            </div>

            <div class="caixa-kpi">
                <h4>Músicas jogadas</h4>
                <div id="KPI-jogosFinalizados" style=" height: auto; width: 80%; font-size: 32px; justify-content: center;">
                    <span id="resultado_jogadas"
                        style="font-family: 'Courier New', Courier, monospace; font-weight: bolder;">0
                    </span>
                </div>
            </div>

        </div>

        <div class="caixa-kpi acertosArtista">
            <div id="GRAFICO_acertosArtistas">
                <canvas id="graficoArtistas"></canvas>
            </div>
        </div>


    </div>

    <div class="dashboards2">
        <div class="coluna-kpi">
            <div class="caixa-kpi certosGenero">
                <div id="GRAFICO-acertosGenero">
                    <h3>Sua margem de acertos em relação outros jogadores</h3>
                </div>
            </div>

            <div class="linha-kpi">

                <div class="caixa-kpi estatisticas">
                    <div id="KPI-artistaFav" >
                        <h4>Artista que mais conhece</h4>
                        <span id="artista_fav" style=" height: auto; width: 80%; font-size: 20px; justify-content: center;">
                    <span id="resultado_ArtistaTop"
                        style="font-family: 'Courier New', Courier, monospace; font-weight: bolder; margin-top: 2%;">Sem dados Adicionados</span>
                        
                    </div>
                </div>

                <div class="caixa-kpi estatisticas">
                    <div id="KPI-musicaFav">
                        <h4>Música que mais conhece</h4>
                        <span id="artista_fav" style=" height: auto; width: 80%; font-size: 18px; justify-content: center;">
                    <span id="resultado_musicaTop"
                        style="font-family: 'Courier New', Courier, monospace; font-weight: bolder; margin-top: 2%;">Sem dados Adicionados</span>
                        

                    </div>
                </div>
            </div>

            <div class="caixa-kpi caixa-playlist"
                style="margin-top: 15px; width: 100%; height: 240px; background-color: #d64e30; border-radius: 15px; padding: 15px; flex-direction: column; display: flex; justify-content: center; align-items: center; ">
                <h4 style="margin: 20px;">Acesse a playlist para mais</h4>
                <div class="capa-playlist">
                    <a href="https://link.deezer.com/s/31JnbQnGPJVbyxT0ZAc7c">
                        <img style="width: 150px; height: 150px; border-radius: 16px;"
                            src="../assets/img/img_capa_playlistPN.png" alt=""></a>
                </div>
            </div>
        </div>

    </div>
    </div>
</body>

</html>

<script>
    var nome = sessionStorage.NOME_USUARIO;
    var idUsuario = sessionStorage.ID_USUARIO;

    if (nome == null || nome == undefined) {
        alert('Faça o cadastro/login primeiro para acessar sua dashboard.')

        console.log('nao ta logado')
        div_aguardar.style.display = "block";
        aguardar();

        setTimeout(function () {
            finalizarAguardar();
            div_aguardar.style.display = "none";
            window.location = "/login.html";
        }, 1500);

    } else {
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
        console.log('logou');

        fetch(`/dashboard/acertosPorArtista/${idUsuario}`)
            .then(res => res.json())
            //a partir daqui ele vira array por causa do res.json
            .then(function (dados) {
                console.log("Dados grafico-acertosArtistas recebidos:", dados);

                var artistas = [];
                var acertos = [];

                for (var i = 0; i < dados.length; i++) {
                    artistas.push(dados[i].artista); // as posicoes do eixo y e x
                    acertos.push(dados[i].total_acertos);
                }

                GraficoAcertosPorArtista(artistas, acertos); // artistas e o y
            })
            .catch(function (erro) {
                console.log("deu errado no grafico de acertos", erro)
            });

        function GraficoAcertosPorArtista(artistas, acertos) {
            const grafico_acertoArtista = document.getElementById('graficoArtistas');

            new Chart(grafico_acertoArtista, {
                type: 'bar',
                data: {
                    labels: artistas,
                    datasets: [{
                        label: 'Acertos',
                        data: acertos,
                        backgroundColor: ['rgba(194,23,23, 1', 'rgba(254,167,18, 1', 'rgba(35,35,149, 1', 'rgba(230, 98, 24, 1', 'rgba(141, 135, 14, 1'],
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },

                options: {
                    indexAxis: 'y', //horizontal
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Acertos por Artista',
                            color: '#fff',
                            font: { size: 20 }
                        }
                    },

                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                        },
                        y: {
                            ticks: { color: '#fff' },
                        }
                    }
                }
            });
        }

        // KPI do TaxaAcertos -------------------------------------------------------------------------------------------
        fetch(`/dashboard/KPI_taxaAcertos/${idUsuario}`)
            .then(res => res.json())
            //a partir daqui ele vira array por causa do res.json
            .then(function (taxa) {
                console.log('ta na taxa');
                console.log("Dados KPI-taxaAcertos recebidos:", taxa);

                if(taxa[0].taxa_acertos == null){
                    resultado.innerHTML = `<span style="font-size: 18px;">Inicie uma tentativa</span>`;    
                }else{
                    resultado.innerHTML = `${(taxa[0].taxa_acertos)}%`;

                }


            })
            .catch(function (erro) {
                console.log("deu errado na KPI taxa", erro)
            });


            // KPI do musicasJogadas -------------------------------------------------------------------------------------------
        fetch(`/dashboard/KPI_musicasJogadas/${idUsuario}`)
            .then(res => res.json())
            //a partir daqui ele vira array por causa do res.json
            .then(function (jogadas) {
                console.log('ta na musgas jogadas');
                console.log("Dados KPI-musicasJogadas recebidos:", jogadas);

                resultado_jogadas.innerHTML = `${jogadas[0].musicas_diferentes}`;

            })
            .catch(function (erro) {
                console.log("deu errado na KPI musicasJogadas", erro)
            });



        //KPI do artista que mais acerta ------------------------------------------------------------------------------------
        fetch(`/dashboard/KPI_artistaFav/${idUsuario}`)
            .then(res => res.json())
            //a partir daqui ele vira array por causa do res.json
            .then(function (artista) {
                console.log("Dados KPI-artistaFav recebidos: ", artista);

                resultado_ArtistaTop.innerHTML = `${(artista[0].artista)}`;

            })
            .catch(function (erro) {
                console.log("deu errado na KPI artistaFav ", erro)
            });

            //KPI da musica que mais acerta ------------------------------------------------------------------------------------
        fetch(`/dashboard/KPI_musicaFav/${idUsuario}`)
            .then(res => res.json())
            .then(function (musica) {
                console.log("Dados KPI-musicaFav recebidos: ", musica);

                resultado_musicaTop.innerHTML = `${(musica[0].musica)}`;

            })
            .catch(function (erro) {
                console.log("deu errado na KPI musicaFav ", erro)
            });

        }
</script>